<!-- tell browser what to expect-->
<!DOCTYPE html>

<link rel="icon" href="data:,">

<!-- specify english as the language -->
<html lang="EN">

<head>
    <title>The Most Dangerous Game</title>
    <!-- provide character set-->
    <meta charset="utf-8">
    <!-- ensure page displays across all platforms-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>
    <!-- centering div-->
    <div style="margin-left: auto; margin-right: auto; text-align: center">
        <h2 id="top">Welcome to...</h2>
        <h1><b>THE MOST DANGEROUS GAME</b></h1>
        <h3>On going games...</h3>

        <table>
            <thead>
                <tr>
                    <th>-- -- Game Title --</th>
                    <th>-- Latitude --</th>
                    <th>-- Longitude --</th>
                    <th>-- Start Date --</th>
                    <th>-- * -- --</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td colspan="5">Loading games...</td>
                </tr>
            </tbody>
        </table>

        <script>
            document.addEventListener('DOMContentLoaded', function () {
                // Fetch the game data from your local API
                fetch('https://themost/games')
                    .then(response => response.json())
                    .then(data => {
                        const tbody = document.querySelector('tbody');
                        tbody.innerHTML = ''; // clear the "Loading..." row

                        if (data.length === 0) {
                            const row = document.createElement('tr');
                            const cell = document.createElement('td');
                            cell.colSpan = 5;
                            cell.textContent = 'No games available.';
                            row.appendChild(cell);
                            tbody.appendChild(row);
                            return;
                        }

                        // Create table rows
                        data.forEach(game => {
                            const row = document.createElement('tr');

                            const idCell = document.createElement('td');
                            idCell.textContent = game.game_id;

                            const latCell = document.createElement('td');
                            latCell.textContent = game.latitude;

                            const lonCell = document.createElement('td');
                            lonCell.textContent = game.longitude;

                            const dateCell = document.createElement('td');
                            dateCell.textContent = game.timestamp;

                            const joinCell = document.createElement('td');
                            const link = document.createElement('a');
                            link.href = `http://localhost:5000/display_game/${game.game_id}`;
                            link.textContent = 'View';
                            joinCell.appendChild(link);

                            row.appendChild(idCell);
                            row.appendChild(latCell);
                            row.appendChild(lonCell);
                            row.appendChild(dateCell);
                            row.appendChild(joinCell);

                            tbody.appendChild(row);
                        });
                    })
                    .catch(error => {
                        console.error('Error fetching games:', error);
                        const tbody = document.querySelector('tbody');
                        tbody.innerHTML = '<tr><td colspan="5">Failed to load games.</td></tr>';
                    });
            });
        </script>
    </div>
    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
<footer>
    <div>
        <h2><a href="/add_game">Begin a game...</a></h2>
    </div>
    <span>
        <b><u>VISITOR COUNTER</u></b>
    </span>
    <div style="margin-left: auto; margin-right: auto; text-align: center">
        <script type="text/javascript" src="https://counter.websiteout.com/js/6/6/0/0"></script>
    </div>
</footer>

</html>